(()=>{"use strict";class t{constructor(){this.timeline=document.getElementById("timeline"),this.postInput=document.getElementById("postInput"),this.setupEventListeners()}static createInput(t,e){const n=document.createElement("input");n.type="text",n.id=t;const o=document.createElement("label");return o.htmlFor=t,o.innerText=`${e}: `,{label:o,input:n}}addPostToTimeline(t,e){const n=new Date,o=n.toLocaleDateString("ru-RU"),i=n.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),d=document.createElement("div");d.classList.add("post");const a=document.createElement("div");a.classList.add("post-datetime"),a.textContent=`${o} ${i}`;const r=document.createElement("div");r.classList.add("post-text"),r.textContent=t;const s=document.createElement("div");s.classList.add("post-coordinates"),s.textContent=`[${e.latitude.toFixed(6)}, ${e.longitude.toFixed(6)}]`,d.appendChild(a),d.appendChild(r),d.appendChild(s),this.timeline.prepend(d)}createCoordinatesForm(e){const n=document.createElement("form");n.id="coordinates-form";const o='\n    <div class="coordinates-form">\n      Что-то пошло не так<br/> <br/>\n      К сожалению, нам не удалось определить Ваше местоположение,<br/>\n      пожалуйста, дайте разрешение на использование геолокации,<br/>\n      либо введите координаты вручную.<br/> <br/> \n      Широта и долгота через запятую.<br/>\n    </div>\n  ',i=document.createElement("label");i.innerHTML=o;const d=t.createInput("coordinates","");d.label.innerHTML=o;const a=document.createElement("div");a.id="button-box";const r=document.createElement("button");r.type="submit",r.innerText="OK";const s=document.createElement("button");return s.type="button",s.innerText="Отмена",s.addEventListener("click",(()=>{n.remove()})),a.appendChild(s),a.appendChild(r),n.appendChild(i),n.appendChild(d.input),n.appendChild(document.createElement("br")),n.appendChild(a),n.addEventListener("submit",(o=>{o.preventDefault();try{const o=t.validateCoordinates(d.input.value),[i,a]=o;this.addPostToTimeline(e,{latitude:i,longitude:a}),n.reset(),n.remove()}catch(t){alert(t.message)}})),n}static validateCoordinates(t){const e=t.trim().match(/^(\[)?(-?\d+(\.\d+)?),\s*(-?\d+(\.\d+)?)(\])?$/);if(!e||"["===e[1]&&"]"!==e[6]||"["!==e[1]&&"]"===e[6])throw new Error("Введите координаты в одном из следующих форматов: 51.50851, -0.12572; 51.50851,-0.12572 или [51.50851, -0.12572].");return[parseFloat(e[2]),parseFloat(e[4])]}static async getUserCoordinates(){return new Promise(((t,e)=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition((e=>{const{latitude:n,longitude:o}=e.coords;t({latitude:n,longitude:o})}),(()=>{e(new Error("Не удалось получить координаты."))})):e(new Error("Geolocation API не поддерживается."))}))}setupEventListeners(){this.postInput.addEventListener("keydown",(async e=>{if("Enter"===e.key){const n=this.postInput.value.trim();if(e.preventDefault(),!n)return void alert("Пожалуйста, введите текст поста.");try{const e=await t.getUserCoordinates();this.addPostToTimeline(n,e),this.postInput.value=""}catch(t){alert(t.message);const e=this.createCoordinatesForm(n);document.body.appendChild(e),this.postInput.value=""}}}))}}document.addEventListener("DOMContentLoaded",(()=>{new t}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBdUIsTUFBYkEsRUFBTSxJQUEyQixNQUFiQSxFQUFNLElBQTZCLE1BQWJBLEVBQU0sSUFBMkIsTUFBYkEsRUFBTSxHQUNqRixNQUFNLElBQUlFLE1BQU0scUhBSWxCLE1BQU8sQ0FGVUMsV0FBV0gsRUFBTSxJQUNoQkcsV0FBV0gsRUFBTSxJQUVyQyxDQUVBLCtCQUFhSSxHQUNYLE9BQU8sSUFBSUMsU0FBUSxDQUFDQyxFQUFTQyxLQUN2QixnQkFBaUJDLFVBQ25CQSxVQUFVQyxZQUFZQyxvQkFDbkJDLElBQ0MsTUFBTSxTQUFFcEMsRUFBUSxVQUFFRSxHQUFja0MsRUFBU0MsT0FDekNOLEVBQVEsQ0FBRS9CLFdBQVVFLGFBQVksSUFFbEMsS0FDRThCLEVBQU8sSUFBSUwsTUFBTSxtQ0FBbUMsSUFJeERLLEVBQU8sSUFBSUwsTUFBTSxzQ0FDbkIsR0FFSixDQUVBekQsbUJBQUFBLEdBQ0VMLEtBQUtJLFVBQVU2QyxpQkFBaUIsV0FBV3dCLFVBQ3pDLEdBQWtCLFVBQWR0QixFQUFNdUIsSUFBaUIsQ0FDekIsTUFBTUMsRUFBVzNFLEtBQUtJLFVBQVVtRCxNQUFNTSxPQUV0QyxHQURBVixFQUFNQyxrQkFDRHVCLEVBRUgsWUFEQWpCLE1BQU0sb0NBR1IsSUFDRSxNQUFNdkMsUUFBb0JyQixFQUFZa0UscUJBQ3RDaEUsS0FBS2lCLGtCQUFrQjBELEVBQVV4RCxHQUNqQ25CLEtBQUtJLFVBQVVtRCxNQUFRLEVBQ3pCLENBQUUsTUFBT0UsR0FDUEMsTUFBTUQsRUFBTUUsU0FDWixNQUFNaUIsRUFBa0I1RSxLQUFLd0Msc0JBQXNCbUMsR0FDbkR6RSxTQUFTMkUsS0FBS3ZDLFlBQVlzQyxHQUMxQjVFLEtBQUtJLFVBQVVtRCxNQUFRLEVBQ3pCLENBQ0YsSUFFSixFQUdGckQsU0FBUytDLGlCQUFpQixvQkFBb0IsS0FFckIsSUFBSW5ELENBQWEsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3dzLWZyb250ZW5kLy4vc3JjL2pzL2FwcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1hbGVydCAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGV4dE1lc3NhZ2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnRpbWVsaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVsaW5lJyk7XG4gICAgdGhpcy5wb3N0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9zdElucHV0Jyk7XG4gICAgdGhpcy5zZXR1cEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlSW5wdXQoaWQsIGxhYmVsVGV4dCkge1xuICAgIGNvbnN0IGlucHV0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgaW5wdXRFbGVtZW50LnR5cGUgPSAndGV4dCc7XG4gICAgaW5wdXRFbGVtZW50LmlkID0gaWQ7XG5cbiAgICBjb25zdCBsYWJlbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGxhYmVsRWxlbWVudC5odG1sRm9yID0gaWQ7XG4gICAgbGFiZWxFbGVtZW50LmlubmVyVGV4dCA9IGAke2xhYmVsVGV4dH06IGA7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhYmVsOiBsYWJlbEVsZW1lbnQsXG4gICAgICBpbnB1dDogaW5wdXRFbGVtZW50LFxuICAgIH07XG4gIH1cblxuICBhZGRQb3N0VG9UaW1lbGluZSh0ZXh0LCBjb29yZGluYXRlcykge1xuICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBmb3JtYXR0ZWREYXRlID0gY3VycmVudFRpbWUudG9Mb2NhbGVEYXRlU3RyaW5nKCdydS1SVScpO1xuICAgIGNvbnN0IGZvcm1hdHRlZFRpbWUgPSBjdXJyZW50VGltZS50b0xvY2FsZVRpbWVTdHJpbmcoJ3J1LVJVJywgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pO1xuXG4gICAgY29uc3QgcG9zdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBwb3N0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwb3N0Jyk7XG5cbiAgICBjb25zdCBwb3N0RGF0ZVRpbWVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcG9zdERhdGVUaW1lRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwb3N0LWRhdGV0aW1lJyk7XG4gICAgcG9zdERhdGVUaW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGAke2Zvcm1hdHRlZERhdGV9ICR7Zm9ybWF0dGVkVGltZX1gO1xuXG4gICAgY29uc3QgcG9zdFRleHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcG9zdFRleHRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Bvc3QtdGV4dCcpO1xuICAgIHBvc3RUZXh0RWxlbWVudC50ZXh0Q29udGVudCA9IHRleHQ7XG5cbiAgICBjb25zdCBwb3N0Q29vcmRpbmF0ZXNFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcG9zdENvb3JkaW5hdGVzRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwb3N0LWNvb3JkaW5hdGVzJyk7XG4gICAgcG9zdENvb3JkaW5hdGVzRWxlbWVudC50ZXh0Q29udGVudCA9IGBbJHtjb29yZGluYXRlcy5sYXRpdHVkZS50b0ZpeGVkKDYpfSwgJHtjb29yZGluYXRlcy5sb25naXR1ZGUudG9GaXhlZCg2KX1dYDtcbiAgICBwb3N0RWxlbWVudC5hcHBlbmRDaGlsZChwb3N0RGF0ZVRpbWVFbGVtZW50KTtcbiAgICBwb3N0RWxlbWVudC5hcHBlbmRDaGlsZChwb3N0VGV4dEVsZW1lbnQpO1xuICAgIHBvc3RFbGVtZW50LmFwcGVuZENoaWxkKHBvc3RDb29yZGluYXRlc0VsZW1lbnQpO1xuICAgIHRoaXMudGltZWxpbmUucHJlcGVuZChwb3N0RWxlbWVudCk7XG4gIH1cblxuICBjcmVhdGVDb29yZGluYXRlc0Zvcm0odGV4dCkge1xuICAgIGNvbnN0IGZvcm1FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpO1xuICAgIGZvcm1FbGVtZW50LmlkID0gJ2Nvb3JkaW5hdGVzLWZvcm0nO1xuICAgIGNvbnN0IGxhYmVsSFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwiY29vcmRpbmF0ZXMtZm9ybVwiPlxuICAgICAg0KfRgtC+LdGC0L4g0L/QvtGI0LvQviDQvdC1INGC0LDQujxici8+IDxici8+XG4gICAgICDQmiDRgdC+0LbQsNC70LXQvdC40Y4sINC90LDQvCDQvdC1INGD0LTQsNC70L7RgdGMINC+0L/RgNC10LTQtdC70LjRgtGMINCS0LDRiNC1INC80LXRgdGC0L7Qv9C+0LvQvtC20LXQvdC40LUsPGJyLz5cbiAgICAgINC/0L7QttCw0LvRg9C50YHRgtCwLCDQtNCw0LnRgtC1INGA0LDQt9GA0LXRiNC10L3QuNC1INC90LAg0LjRgdC/0L7Qu9GM0LfQvtCy0LDQvdC40LUg0LPQtdC+0LvQvtC60LDRhtC40LgsPGJyLz5cbiAgICAgINC70LjQsdC+INCy0LLQtdC00LjRgtC1INC60L7QvtGA0LTQuNC90LDRgtGLINCy0YDRg9GH0L3Rg9GOLjxici8+IDxici8+IFxuICAgICAg0KjQuNGA0L7RgtCwINC4INC00L7Qu9Cz0L7RgtCwINGH0LXRgNC10Lcg0LfQsNC/0Y/RgtGD0Y4uPGJyLz5cbiAgICA8L2Rpdj5cbiAgYDtcblxuICAgIGNvbnN0IGNvb3JkaW5hdGVJbnB1dExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBjb29yZGluYXRlSW5wdXRMYWJlbC5pbm5lckhUTUwgPSBsYWJlbEhUTUw7XG5cbiAgICBjb25zdCBjb29yZGluYXRlSW5wdXQgPSBUZXh0TWVzc2FnZS5jcmVhdGVJbnB1dCgnY29vcmRpbmF0ZXMnLCAnJyk7XG4gICAgY29vcmRpbmF0ZUlucHV0LmxhYmVsLmlubmVySFRNTCA9IGxhYmVsSFRNTDtcblxuICAgIGNvbnN0IGJ1dHRvbnNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBidXR0b25zQ29udGFpbmVyLmlkID0gJ2J1dHRvbi1ib3gnO1xuXG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgc3VibWl0QnV0dG9uLnR5cGUgPSAnc3VibWl0JztcbiAgICBzdWJtaXRCdXR0b24uaW5uZXJUZXh0ID0gJ09LJztcblxuICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgIGNhbmNlbEJ1dHRvbi50eXBlID0gJ2J1dHRvbic7XG4gICAgY2FuY2VsQnV0dG9uLmlubmVyVGV4dCA9ICfQntGC0LzQtdC90LAnO1xuICAgIGNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGZvcm1FbGVtZW50LnJlbW92ZSgpO1xuICAgIH0pO1xuXG4gICAgYnV0dG9uc0NvbnRhaW5lci5hcHBlbmRDaGlsZChjYW5jZWxCdXR0b24pO1xuICAgIGJ1dHRvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoc3VibWl0QnV0dG9uKTtcblxuICAgIGZvcm1FbGVtZW50LmFwcGVuZENoaWxkKGNvb3JkaW5hdGVJbnB1dExhYmVsKTtcbiAgICBmb3JtRWxlbWVudC5hcHBlbmRDaGlsZChjb29yZGluYXRlSW5wdXQuaW5wdXQpO1xuICAgIGZvcm1FbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpO1xuICAgIGZvcm1FbGVtZW50LmFwcGVuZENoaWxkKGJ1dHRvbnNDb250YWluZXIpO1xuICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvb3JkaW5hdGVWYWx1ZXMgPSBUZXh0TWVzc2FnZS52YWxpZGF0ZUNvb3JkaW5hdGVzKGNvb3JkaW5hdGVJbnB1dC5pbnB1dC52YWx1ZSk7XG4gICAgICAgIGNvbnN0IFtsYXRpdHVkZSwgbG9uZ2l0dWRlXSA9IGNvb3JkaW5hdGVWYWx1ZXM7XG4gICAgICAgIHRoaXMuYWRkUG9zdFRvVGltZWxpbmUodGV4dCwge1xuICAgICAgICAgIGxhdGl0dWRlLFxuICAgICAgICAgIGxvbmdpdHVkZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGZvcm1FbGVtZW50LnJlc2V0KCk7XG4gICAgICAgIGZvcm1FbGVtZW50LnJlbW92ZSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgYWxlcnQoZXJyb3IubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvcm1FbGVtZW50O1xuICB9XG5cbiAgc3RhdGljIHZhbGlkYXRlQ29vcmRpbmF0ZXMoaW5wdXQpIHtcbiAgICBjb25zdCBjb29yZGluYXRlUGF0dGVybiA9IC9eKFxcWyk/KC0/XFxkKyhcXC5cXGQrKT8pLFxccyooLT9cXGQrKFxcLlxcZCspPykoXFxdKT8kLztcbiAgICBjb25zdCBtYXRjaCA9IGlucHV0LnRyaW0oKS5tYXRjaChjb29yZGluYXRlUGF0dGVybik7XG4gICAgaWYgKCFtYXRjaCB8fCAobWF0Y2hbMV0gPT09ICdbJyAmJiBtYXRjaFs2XSAhPT0gJ10nKSB8fCAobWF0Y2hbMV0gIT09ICdbJyAmJiBtYXRjaFs2XSA9PT0gJ10nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCfQktCy0LXQtNC40YLQtSDQutC+0L7RgNC00LjQvdCw0YLRiyDQsiDQvtC00L3QvtC8INC40Lcg0YHQu9C10LTRg9GO0YnQuNGFINGE0L7RgNC80LDRgtC+0LI6IDUxLjUwODUxLCAtMC4xMjU3MjsgNTEuNTA4NTEsLTAuMTI1NzIg0LjQu9C4IFs1MS41MDg1MSwgLTAuMTI1NzJdLicpO1xuICAgIH1cbiAgICBjb25zdCBsYXRpdHVkZSA9IHBhcnNlRmxvYXQobWF0Y2hbMl0pO1xuICAgIGNvbnN0IGxvbmdpdHVkZSA9IHBhcnNlRmxvYXQobWF0Y2hbNF0pO1xuICAgIHJldHVybiBbbGF0aXR1ZGUsIGxvbmdpdHVkZV07XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0VXNlckNvb3JkaW5hdGVzKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAoJ2dlb2xvY2F0aW9uJyBpbiBuYXZpZ2F0b3IpIHtcbiAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihcbiAgICAgICAgICAocG9zaXRpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgbGF0aXR1ZGUsIGxvbmdpdHVkZSB9ID0gcG9zaXRpb24uY29vcmRzO1xuICAgICAgICAgICAgcmVzb2x2ZSh7IGxhdGl0dWRlLCBsb25naXR1ZGUgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCfQndC1INGD0LTQsNC70L7RgdGMINC/0L7Qu9GD0YfQuNGC0Ywg0LrQvtC+0YDQtNC40L3QsNGC0YsuJykpO1xuICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKCdHZW9sb2NhdGlvbiBBUEkg0L3QtSDQv9C+0LTQtNC10YDQttC40LLQsNC10YLRgdGPLicpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHNldHVwRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5wb3N0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICBjb25zdCBwb3N0VGV4dCA9IHRoaXMucG9zdElucHV0LnZhbHVlLnRyaW0oKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYgKCFwb3N0VGV4dCkge1xuICAgICAgICAgIGFsZXJ0KCfQn9C+0LbQsNC70YPQudGB0YLQsCwg0LLQstC10LTQuNGC0LUg0YLQtdC60YHRgiDQv9C+0YHRgtCwLicpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gYXdhaXQgVGV4dE1lc3NhZ2UuZ2V0VXNlckNvb3JkaW5hdGVzKCk7XG4gICAgICAgICAgdGhpcy5hZGRQb3N0VG9UaW1lbGluZShwb3N0VGV4dCwgY29vcmRpbmF0ZXMpO1xuICAgICAgICAgIHRoaXMucG9zdElucHV0LnZhbHVlID0gJyc7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgYWxlcnQoZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgY29uc3QgY29vcmRpbmF0ZXNGb3JtID0gdGhpcy5jcmVhdGVDb29yZGluYXRlc0Zvcm0ocG9zdFRleHQpO1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29vcmRpbmF0ZXNGb3JtKTtcbiAgICAgICAgICB0aGlzLnBvc3RJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIGNvbnN0IHRleHRNZXNzYWdlQXBwID0gbmV3IFRleHRNZXNzYWdlKCk7XG59KTtcbiJdLCJuYW1lcyI6WyJUZXh0TWVzc2FnZSIsImNvbnN0cnVjdG9yIiwidGhpcyIsInRpbWVsaW5lIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInBvc3RJbnB1dCIsInNldHVwRXZlbnRMaXN0ZW5lcnMiLCJjcmVhdGVJbnB1dCIsImlkIiwibGFiZWxUZXh0IiwiaW5wdXRFbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJsYWJlbEVsZW1lbnQiLCJodG1sRm9yIiwiaW5uZXJUZXh0IiwibGFiZWwiLCJpbnB1dCIsImFkZFBvc3RUb1RpbWVsaW5lIiwidGV4dCIsImNvb3JkaW5hdGVzIiwiY3VycmVudFRpbWUiLCJEYXRlIiwiZm9ybWF0dGVkRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsImZvcm1hdHRlZFRpbWUiLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJob3VyIiwibWludXRlIiwicG9zdEVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJwb3N0RGF0ZVRpbWVFbGVtZW50IiwidGV4dENvbnRlbnQiLCJwb3N0VGV4dEVsZW1lbnQiLCJwb3N0Q29vcmRpbmF0ZXNFbGVtZW50IiwibGF0aXR1ZGUiLCJ0b0ZpeGVkIiwibG9uZ2l0dWRlIiwiYXBwZW5kQ2hpbGQiLCJwcmVwZW5kIiwiY3JlYXRlQ29vcmRpbmF0ZXNGb3JtIiwiZm9ybUVsZW1lbnQiLCJsYWJlbEhUTUwiLCJjb29yZGluYXRlSW5wdXRMYWJlbCIsImlubmVySFRNTCIsImNvb3JkaW5hdGVJbnB1dCIsImJ1dHRvbnNDb250YWluZXIiLCJzdWJtaXRCdXR0b24iLCJjYW5jZWxCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImNvb3JkaW5hdGVWYWx1ZXMiLCJ2YWxpZGF0ZUNvb3JkaW5hdGVzIiwidmFsdWUiLCJyZXNldCIsImVycm9yIiwiYWxlcnQiLCJtZXNzYWdlIiwibWF0Y2giLCJ0cmltIiwiRXJyb3IiLCJwYXJzZUZsb2F0IiwiZ2V0VXNlckNvb3JkaW5hdGVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJuYXZpZ2F0b3IiLCJnZW9sb2NhdGlvbiIsImdldEN1cnJlbnRQb3NpdGlvbiIsInBvc2l0aW9uIiwiY29vcmRzIiwiYXN5bmMiLCJrZXkiLCJwb3N0VGV4dCIsImNvb3JkaW5hdGVzRm9ybSIsImJvZHkiXSwic291cmNlUm9vdCI6IiJ9